<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

  <!--radix_placeholder_meta_tags-->
  <title>Hurricane Harvey Storm Reports: Code</title>
  
  <meta property="description" itemprop="description" content="How the hurricane preliminary reports were scraped and parsed."/>
  
  
  
  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Hurricane Harvey Storm Reports: Code"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="How the hurricane preliminary reports were scraped and parsed."/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:site_name" content="Hurricane Harvey Storm Reports"/>
  
  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="Hurricane Harvey Storm Reports: Code"/>
  <meta property="twitter:description" content="How the hurricane preliminary reports were scraped and parsed."/>
  
  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description"]}},"value":[{"type":"character","attributes":{},"value":["Code"]},{"type":"character","attributes":{},"value":["How the hurricane preliminary reports were scraped and parsed."]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  <!--radix_placeholder_navigation_in_header-->
  
  <script type="application/javascript">
  
    window.headroom_prevent_pin = false;
  
    window.document.addEventListener("DOMContentLoaded", function (event) {
  
      // initialize headroom for banner
      var header = $('header').get(0);
      var headerHeight = header.offsetHeight;
      var headroom = new Headroom(header, {
        onPin : function() {
          if (window.headroom_prevent_pin) {
            window.headroom_prevent_pin = false;
            headroom.unpin();
          }
        }
      });
      headroom.init();
      if(window.location.hash)
        headroom.unpin();
      $(header).addClass('headroom--transition');
  
      // offset scroll location for banner on hash change
      // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
      window.addEventListener("hashchange", function(event) {
        window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
      });
  
      // responsive menu
      $('.distill-site-header').each(function(i, val) {
        var topnav = $(this);
        var toggle = topnav.find('.nav-toggle');
        toggle.on('click', function() {
          topnav.toggleClass('responsive');
        });
      });
  
      // nav dropdowns
      $('.nav-dropbtn').click(function(e) {
        $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
        $(this).parent().siblings('.nav-dropdown')
           .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $("body").click(function(e){
        $('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $(".nav-dropdown").click(function(e){
        e.stopPropagation();
      });
    });
  </script>
  
  <style type="text/css">
  
  /* Theme (user-documented overrideables for nav appearance) */
  
  .distill-site-nav {
    color: rgba(255, 255, 255, 0.8);
    background-color: #455a64;
    font-size: 15px;
    font-weight: 300;
  }
  
  .distill-site-nav a {
    color: inherit;
    text-decoration: none;
  }
  
  .distill-site-nav a:hover {
    color: white;
  }
  
  @media print {
    .distill-site-nav {
      display: none;
    }
  }
  
  .distill-site-header {
  
  }
  
  .distill-site-footer {
  
  }
  
  
  /* Site Header */
  
  .distill-site-header {
    width: 100%;
    box-sizing: border-box;
    z-index: 3;
  }
  
  .distill-site-header .nav-left {
    display: inline-block;
    margin-left: 8px;
  }
  
  @media screen and (max-width: 768px) {
    .distill-site-header .nav-left {
      margin-left: 0;
    }
  }
  
  
  .distill-site-header .nav-right {
    float: right;
    margin-right: 8px;
  }
  
  .distill-site-header a,
  .distill-site-header .title {
    display: inline-block;
    text-align: center;
    padding: 14px 10px 14px 10px;
  }
  
  .distill-site-header .title {
    font-size: 18px;
  }
  
  .distill-site-header .logo {
    padding: 0;
  }
  
  .distill-site-header .logo img {
    display: none;
    max-height: 20px;
    width: auto;
    margin-bottom: -4px;
  }
  
  .distill-site-header .nav-image img {
    max-height: 18px;
    width: auto;
    display: inline-block;
    margin-bottom: -3px;
  }
  
  
  
  @media screen and (min-width: 1000px) {
    .distill-site-header .logo img {
      display: inline-block;
    }
    .distill-site-header .nav-left {
      margin-left: 20px;
    }
    .distill-site-header .nav-right {
      margin-right: 20px;
    }
    .distill-site-header .title {
      padding-left: 12px;
    }
  }
  
  
  .distill-site-header .nav-toggle {
    display: none;
  }
  
  .nav-dropdown {
    display: inline-block;
    position: relative;
  }
  
  .nav-dropdown .nav-dropbtn {
    border: none;
    outline: none;
    color: rgba(255, 255, 255, 0.8);
    padding: 16px 10px;
    background-color: transparent;
    font-family: inherit;
    font-size: inherit;
    font-weight: inherit;
    margin: 0;
    margin-top: 1px;
    z-index: 2;
  }
  
  .nav-dropdown-content {
    display: none;
    position: absolute;
    background-color: white;
    min-width: 200px;
    border: 1px solid rgba(0,0,0,0.15);
    border-radius: 4px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
    z-index: 1;
    margin-top: 2px;
    white-space: nowrap;
    padding-top: 4px;
    padding-bottom: 4px;
  }
  
  .nav-dropdown-content hr {
    margin-top: 4px;
    margin-bottom: 4px;
    border: none;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .nav-dropdown-active {
    display: block;
  }
  
  .nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
    color: black;
    padding: 6px 24px;
    text-decoration: none;
    display: block;
    text-align: left;
  }
  
  .nav-dropdown-content .nav-dropdown-header {
    display: block;
    padding: 5px 24px;
    padding-bottom: 0;
    text-transform: uppercase;
    font-size: 14px;
    color: #999999;
    white-space: nowrap;
  }
  
  .nav-dropdown:hover .nav-dropbtn {
    color: white;
  }
  
  .nav-dropdown-content a:hover {
    background-color: #ddd;
    color: black;
  }
  
  .nav-right .nav-dropdown-content {
    margin-left: -45%;
    right: 0;
  }
  
  @media screen and (max-width: 768px) {
    .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
    .distill-site-header a.nav-toggle {
      float: right;
      display: block;
    }
    .distill-site-header .title {
      margin-left: 0;
    }
    .distill-site-header .nav-right {
      margin-right: 0;
    }
    .distill-site-header {
      overflow: hidden;
    }
    .nav-right .nav-dropdown-content {
      margin-left: 0;
    }
  }
  
  
  @media screen and (max-width: 768px) {
    .distill-site-header.responsive {position: relative;}
    .distill-site-header.responsive a.nav-toggle {
      position: absolute;
      right: 0;
      top: 0;
    }
    .distill-site-header.responsive a,
    .distill-site-header.responsive .nav-dropdown {
      display: block;
      text-align: left;
    }
    .distill-site-header.responsive .nav-left,
    .distill-site-header.responsive .nav-right {
      width: 100%;
    }
    .distill-site-header.responsive .nav-dropdown {float: none;}
    .distill-site-header.responsive .nav-dropdown-content {position: relative;}
    .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
      display: block;
      width: 100%;
      text-align: left;
    }
  }
  
  /* Site Footer */
  
  .distill-site-footer {
    width: 100%;
    overflow: hidden;
    box-sizing: border-box;
    z-index: 3;
    margin-top: 30px;
    padding-top: 30px;
    padding-bottom: 30px;
    text-align: center;
  }
  
  /* Headroom */
  
  d-title {
    padding-top: 6rem;
  }
  
  @media print {
    d-title {
      padding-top: 4rem;
    }
  }
  
  .headroom {
    z-index: 1000;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
  }
  
  .headroom--transition {
    transition: all .4s ease-in-out;
  }
  
  .headroom--unpinned {
    top: -100px;
  }
  
  .headroom--pinned {
    top: 0;
  }
  
  </style>
  
  <link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
  <link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
  <script src="site_libs/headroom-0.9.4/headroom.min.js"></script>
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->
  
  <style type="text/css">
  
  body {
    background-color: white;
  }
  
  .pandoc-table {
    width: 100%;
  }
  
  .pandoc-table>caption {
    margin-bottom: 10px;
  }
  
  .pandoc-table th:not([align]) {
    text-align: left;
  }
  
  .pagedtable-footer {
    font-size: 15px;
  }
  
  .html-widget {
    margin-bottom: 2.0em;
  }
  
  .l-screen-inset {
    padding-right: 16px;
  }
  
  .l-screen .caption {
    margin-left: 10px;
  }
  
  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .shaded .shaded-content {
    background: white;
  }
  
  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }
  
  .hidden {
    display: none !important;
  }
  
  d-article {
    padding-bottom: 30px;
  }
  
  d-appendix {
    padding-top: 30px;
  }
  
  d-article>p>img {
    width: 100%;
  }
  
  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }
  
  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }
  
  /* CSS for table of contents */
  
  .d-toc {
    color: rgba(0,0,0,0.8);
    font-size: 0.8em;
    line-height: 1em;
  }
  
  .d-toc-header {
    font-size: 0.6rem;
    font-weight: 400;
    color: rgba(0, 0, 0, 0.5);
    text-transform: uppercase;
    margin-top: 0;
    margin-bottom: 1.3em;
  }
  
  .d-toc a {
    border-bottom: none;
  }
  
  .d-toc ul {
    padding-left: 0;
  }
  
  .d-toc li>ul {
    padding-top: 0.8em;
    padding-left: 16px;
    margin-bottom: 0.6em;
  }
  
  .d-toc ul,
  .d-toc li {
    list-style-type: none;
  }
  
  .d-toc li {
    margin-bottom: 0.9em;
  }
  
  .d-toc-separator {
    margin-top: 20px;
    margin-bottom: 2em;
  }
  
  .d-article-with-toc {
    border-top: none;
    padding-top: 0;
  }
  
  
  
  /* Tweak code blocks (note that this CSS is repeated above in an injection
     into the d-code shadow dom) */
  
  d-code {
    overflow-x: auto !important;
  }
  
  pre.d-code code.d-code {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }
  
  pre.text-output {
  
    font-size: 12px;
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;
  
    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;
  
    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }
  
  @media(min-width: 768px) {
  
  d-code {
    overflow-x: visible !important;
  }
  
  pre.d-code code.d-code  {
      padding-left: 18px;
      font-size: 14px;
  }
  pre.text-output {
    font-size: 14px;
  }
  }
  
  /* Figure */
  
  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }
  
  .figure img {
    width: 100%;
  }
  
  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }
  
  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }
  
  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }
  
  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }
  
  
  
  /* Tweak 1000px media break to show more text */
  
  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }
  
    .grid {
      grid-column-gap: 16px;
    }
  
    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }
  
  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }
  
    .grid {
      grid-column-gap: 32px;
    }
  }
  
  
  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */
  
  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }
  
  
  /* Social footer */
  
  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }
  
  .disqus-comments {
    margin-right: 30px;
  }
  
  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }
  
  #disqus_thread {
    margin-top: 30px;
  }
  
  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }
  
  .article-sharing a:hover {
    border-bottom: none;
  }
  
  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }
  
  .subscribe p {
    margin-bottom: 0.5em;
  }
  
  
  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }
  
  
  /* Improve display for browsers without grid (IE/Edge <= 15) */
  
  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }
  
  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }
  
  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }
  
  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }
  
  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }
  
  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }
  
  
  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }
  
  .downlevel .footnotes ol {
    padding-left: 13px;
  }
  
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }
  
  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }
  
  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }
  
  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;
  
    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;
  
    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }
  
  </style>
  
  <script type="application/javascript">
  
  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }
  
  // show body when load is complete
  function on_load_complete() {
  
    // set body to visible
    document.body.style.visibility = 'visible';
  
    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }
  
    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }
  
  function init_distill() {
  
    init_common();
  
    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);
  
    // create d-title
    $('.d-title').changeElementType('d-title');
  
    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);
  
    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();
  
    // move posts container into article
    $('.posts-container').appendTo($('d-article'));
  
    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');
  
    // create d-bibliography
    var bibliography = $('<d-bibliography></d-bibliography>');
    $('#distill-bibliography').wrap(bibliography);
  
    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;
  
    // replace citations with <d-cite>
    $('.citation').each(function(i, val) {
      appendix = true;
      var cites = $(this).attr('data-cites').split(" ");
      var dt_cite = $('<d-cite></d-cite>');
      dt_cite.attr('key', cites.join());
      $(this).replaceWith(dt_cite);
    });
    // remove refs
    $('#refs').remove();
  
    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();
  
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-toc a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });
  
    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');
  
    // replace code blocks with d-code
    $('pre>code').each(function(i, val) {
      var code = $(this);
      var pre = code.parent();
      var clz = "";
      var language = pre.attr('class');
      if (language) {
        // map unknown languages to "clike" (without this they just dissapear)
        if ($.inArray(language, ["bash", "clike", "css", "go", "html",
                                 "javascript", "js", "julia", "lua", "markdown",
                                 "markup", "mathml", "python", "svg", "xml"]) == -1)
          language = "clike";
        language = ' language="' + language + '"';
        var dt_code = $('<d-code block' + language + clz + '></d-code>');
        dt_code.text(code.text());
        pre.replaceWith(dt_code);
      } else {
        code.addClass('text-output').unwrap().changeElementType('pre');
      }
    });
  
    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {
  
      // capture layout
      var layout = $(this).attr('data-layout');
  
      // apply layout to markdown level block elements
      var elements = $(this).children().not('d-code, pre.text-output, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });
  
  
      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });
  
    // load distill framework
    load_distill_framework();
  
    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {
  
      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;
  
      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');
  
      // table of contents
      if (have_authors) // adjust border if we are in authors
        $('.d-toc').parent().addClass('d-article-with-toc');
  
      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');
  
      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }
  
      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');
  
      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");
  
      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }
  
       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }
  
      // inject pre code styles (can't do this with a global stylesheet b/c a shadow root is used)
      $('d-code').each(function(i, val) {
        var style = document.createElement('style');
        style.innerHTML = 'pre code { padding-left: 10px; font-size: 12px; border-left: 2px solid rgba(0,0,0,0.1); } ' +
                          '@media(min-width: 768px) { pre code { padding-left: 18px; font-size: 14px; } }';
        if (this.shadowRoot)
          this.shadowRoot.appendChild(style);
      });
  
      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();
  
      // clear polling timer
      clearInterval(tid);
  
      // show body now that everything is ready
      on_load_complete();
    }
  
    var tid = setInterval(distill_post_process, 50);
    distill_post_process();
  
  }
  
  function init_downlevel() {
  
    init_common();
  
     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));
  
    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
  
    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();
  
    // remove toc
    $('.d-toc-header').remove();
    $('.d-toc').remove();
    $('.d-toc-separator').remove();
  
    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });
  
  
    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);
  
    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);
  
    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();
  
    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();
  
    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));
  
    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });
  
    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));
  
    $('body').addClass('downlevel');
  
    on_load_complete();
  }
  
  
  function init_common() {
  
    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};
  
        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });
  
        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);
  
    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});
  
    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });
  
      }
    });
  
    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });
  
    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }
  
    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');
  
    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");
  
    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();
  
    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }
  
  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });
  
  </script>
  
  <!--/radix_placeholder_distill-->
  <script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
  <script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
  <script src="site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-1507390-30"></script>
  <script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-1507390-30');
  </script>
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Code","description":"How the hurricane preliminary reports were scraped and parsed.","authors":[]}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a href="index.html" class="title">Hurricane Harvey Preliminary Reports</a>
<a href="index.html">The Report</a>
<a href="data.html">The Data</a>
</div>
<div class="nav-right">
<a href="https://github.com/timtrice/hurricane_harvey_prelims">
<i class="fab fa-github"></i>
</a>
<a href="https://cloud.docker.com/repository/docker/timtrice/hurricane_harvey_prelims">
<i class="fab fa-docker"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Code</h1>
<p>How the hurricane preliminary reports were scraped and parsed.</p>
</div>


<div class="d-article">
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
source(here::here(&quot;./R/functions.R&quot;))</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
input &lt;- knitr::current_input()</code></pre>
</div>
<p>These text products are listed under the header ACUS74. They can be found on the <a href="ftp://tgftp.nws.noaa.gov/data/raw/ac/">National Weather Service FTP server</a>.</p>
<p>The following reports were obtained:</p>
<ul>
<li><p><a href="ftp://tgftp.nws.noaa.gov/data/raw/ac/acus74.kbro.psh.bro.txt">Brownsville, TX (BRO)</a></p></li>
<li><p><a href="ftp://tgftp.nws.noaa.gov/data/raw/ac/acus74.kcrp.psh.crp.txt">Corpus Christi, TX (CRP)</a></p></li>
<li><p><a href="ftp://tgftp.nws.noaa.gov/data/raw/ac/acus74.kewx.psh.ewx.txt">Austin/San Antonion, TX (EWX)</a></p></li>
<li><p><a href="ftp://tgftp.nws.noaa.gov/data/raw/ac/acus74.khgx.psh.hgx.txt">Houston, TX (HGX)</a></p></li>
<li><p><a href="ftp://tgftp.nws.noaa.gov/data/raw/ac/acus74.klch.psh.lch.txt">Lake Charles, LA (LCH)</a></p></li>
<li><p><a href="ftp://tgftp.nws.noaa.gov/data/raw/ac/acus74.klix.psh.lix.txt">New Orleans, LA (LIX)</a></p></li>
</ul>
<p>The links above point to the latest ACUS74 product issued by the respective NWS office. Therefore, it is possible that by the time you have read this article, the content of the text product has changed. Because of this, the rds data files have been saved to this website’s <a href="https://github.com/timtrice/hurricane_harvey_prelims/tree/0c55d581f268acd1be4f8034ac6da5c35ce85a26/data">GitHub repository</a>.</p>
<p>All times reported are in UTC. Pressure observations are in millibars. Wind and Gust observations are in knots.</p>
<h2 id="libraries">Libraries</h2>
<p>The following libraries were used in this article:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
library(dplyr)
library(glue)
library(lubridate)
library(purrr)
library(stringr)
library(tibble)</code></pre>
</div>
<h2 id="data">Data</h2>
<p>To load the data, I just put the links into a named list. I originally had considered keeping the data separate by NWS office but determined this was not necessary.</p>
<p>The code below looks for the data file mentioned earlier and, if it exists, loads the <code>txt</code> vector. Otherwise, each of the text products will be collected for parsing.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
rpts &lt;- c(
  &quot;bro&quot; = &quot;acus74.kbro.psh.bro.txt&quot;,
  &quot;crp&quot; = &quot;acus74.kcrp.psh.crp.txt&quot;,
  &quot;ewx&quot; = &quot;acus74.kewx.psh.ewx.txt&quot;,
  &quot;hgx&quot; = &quot;acus74.khgx.psh.hgx.txt&quot;,
  &quot;lch&quot; = &quot;acus74.klch.psh.lch.txt&quot;,
  &quot;lix&quot; = &quot;acus74.klix.psh.lix.txt&quot;
)

# Read data
txt &lt;- map(rpts, ~readLines(here::here(glue(&quot;./data/{.x}&quot;))))</code></pre>
</div>
<p>Each text product contains several sections:</p>
<ul>
<li><p>Section A. Lowest Sea Level Pressure/Maximum Sustained Winds and Peak Gusts</p></li>
<li><p>Non-METAR Observations</p></li>
<li><p>Section B. Marine Observations</p></li>
<li><p>Section C. Storm Total Rainfall</p></li>
<li><p>Section D. Inland Flooding (not collected)</p></li>
<li><p>Section E. Maximum Storm Surge and Storm Tide (not collected)</p></li>
<li><p>Section F. Tornadoes</p></li>
<li><p>Section G. Storm Impacts by County (not collected)</p></li>
</ul>
<p>Not all sections will contain data. For this article, all data collected was that which contained a latitude and longitude position.</p>
<p>Each section contains a data header:</p>
<pre><code>
A. LOWEST SEA LEVEL PRESSURE/MAXIMUM SUSTAINED WINDS AND PEAK GUSTS
---------------------------------------------------------------------
METAR OBSERVATIONS...
NOTE: ANEMOMETER HEIGHT IS 10 METERS AND WIND AVERAGING IS 2 MINUTES
---------------------------------------------------------------------
LOCATION  ID    MIN    DATE/     MAX      DATE/     PEAK    DATE/
LAT  LON        PRES   TIME      SUST     TIME      GUST    TIME
DEG DECIMAL     (MB)   (UTC)     (KT)     (UTC)     (KT)    (UTC)
---------------------------------------------------------------------</code></pre>
<pre><code>
B. MARINE OBSERVATIONS...
NOTE: ANEMOMETER HEIGHT IN METERS AND WIND AVERAGING PERIOD IN
MINUTES INDICATED UNDER MAXIMUM SUSTAINED WIND IF KNOWN
---------------------------------------------------------------------
LOCATION  ID    MIN    DATE/     MAX      DATE/     PEAK    DATE/
LAT  LON        PRES   TIME      SUST     TIME      GUST    TIME
DEG DECIMAL     (MB)   (UTC)     (KT)     (UTC)     (KT)    (UTC)
---------------------------------------------------------------------</code></pre>
<p>Additionally, a subsection of A exists:</p>
<pre><code>
NON-METAR OBSERVATIONS... 
NOTE: ANEMOMETER HEIGHT IN METERS AND WIND AVERAGING PERIOD IN
MINUTES INDICATED UNDER MAXIMUM SUSTAINED WIND IF KNOWN
---------------------------------------------------------------------
LOCATION  ID    MIN    DATE/     MAX      DATE/     PEAK    DATE/
LAT  LON        PRES   TIME      SUST     TIME      GUST    TIME
DEG DECIMAL     (MB)   (UTC)     (KT)     (UTC)     (KT)    (UTC)
---------------------------------------------------------------------</code></pre>
<p>This subsection was added in as part of Sectoin A but is indistinguishable in the parsed dataset.</p>
<p>Observation examples are inluded in the relevant section below.</p>
<p>Numerous observations contain remarks (identified in the dataset by <code>ends_with(&quot;Rmks&quot;)</code>). Every section contains a Remarks footer; however, this may not be populated and, therefore, not every observation with a <code>.Rmks</code> variable would have additional Remarks listed in the text product. The additional Remarks were not collected.</p>
<p>The <code>.Rmks</code> legend is identified in the footer of each text product as:</p>
<ul>
<li><p>“I” - Incomplete data</p></li>
<li><p>“E” - Estimated</p></li>
</ul>
<p>All <code>.Rmks</code> variables in the datasets are either <em>NA</em> or “I”.</p>
<p>Sections A and B may also contain additional anenometer height and wind-averaging period variables on a third line. This data was not collected but could easily have been; I did not feel it was relevant to this article.</p>
<h3 id="sea-level-pressure-and-marine-observations">Sea Level Pressure and Marine Observations</h3>
<p>A typical observation in Section A or B will look like the following:</p>
<pre><code>
RCPT2-ROCKPORT                                                      
28.02  -97.05   941.8 26/0336 I 017/059  26/0154 I 016/094 26/0148 I</code></pre>
<p>There are 15 variables in the observation above (in order as they appear, with the example text):</p>
<ul>
<li><p><code>ID</code> (RCPT2)</p></li>
<li><p><code>Station</code> (ROCKPORT)</p></li>
<li><p><code>Lat</code> (28.02)</p></li>
<li><p><code>Lon</code> (-97.05)</p></li>
<li><p><code>Pres</code> (941.8) [barometric pressure, mb]</p></li>
<li><p><code>PresDT</code> (26/0336) [date/time of <code>Pres</code> observation, UTC]</p></li>
<li><p><code>PresRmks</code> (I) [incomplete pressure observation]</p></li>
<li><p><code>Wind</code>, <code>WindDir</code> (017/059) [wind speed, kts, and wind direction]</p></li>
<li><p><code>WindDT</code> (26/0154) [date/time of preceeding wind observation, UTC]</p></li>
<li><p><code>WindRmks</code> (I) [incomplete wind observation]</p></li>
<li><p><code>Gust</code>, <code>GustDir</code> (016/094) [maximum gust, kts, and direction]</p></li>
<li><p><code>GustDT</code> (26/0148) [date/time of preceeding gust observation, UTC]</p></li>
<li><p><code>GustRmks</code> (I) [incomplete gust observation]</p></li>
</ul>
<p>Every observation has an empty line before and after which can be used as a delimiter to spilt observations.</p>
<p>To extract the relevant sections, I loop through the text products (<code>txt</code>) and identify where Section A and Section C begins. With these numerical indices, I can extract both sections, assigning the subset to <code>slp_raw</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
slp_raw &lt;- c(map(txt, ~.[grep(&quot;^A\\.&quot;, .):grep(&quot;^C\\.&quot;, .)])) %&gt;%
  flatten_chr()</code></pre>
</div>
<p>From there, I identify all vector elements that begin with a latitude and longitude field. I counted these values (<code>slp_n</code>) so that I know exactly how long my final results will be (and to check progress as I move along, making sure I haven’t inadvertently removed anything).</p>
<p>Once I know where the observation indices are (<code>slp_obs_n</code>) I can find the station identification by calculating <code>slp_obs_n - 1</code>; this gives me <code>slp_stations_n</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
slp_obs_ptn &lt;- &quot;^\\d\\d\\.\\d\\d\\s*-*\\d\\d\\d*\\.\\d\\d.+&quot;
slp_n &lt;- sum(str_count(slp_raw, slp_obs_ptn))
slp_obs_n &lt;- str_which(slp_raw, slp_obs_ptn)
slp_stations_n &lt;- slp_obs_n - 1</code></pre>
</div>
<p>Before merging the two vectors, I found some station values were not all the same length; I felt this would be beneficial with the regex. I create <code>slp_stations</code>, first trimming all values then finding the max length value. With the max length, I rounded up to the nearest ten and padded all all values to the right.</p>
<p>The last bit of manipulation involved replacing the first “-”, if available, with a “\t” character. This also helped me make it easier to split variables <code>ID</code> and <code>Station</code> since <code>Station</code> would contain additional “-” characters.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
slp_stations &lt;-
  slp_raw[slp_stations_n] %&gt;%
  str_trim() %&gt;%
  str_pad(width = round(max(nchar(.)), digits = -1), side = &quot;right&quot;) %&gt;%
  # Replace first &quot;-&quot; with &quot;\t&quot; to help split ID and Station
  str_replace(&quot;\\s*-\\s*&quot;, &quot;\t&quot;)</code></pre>
</div>
<p>Note that the code above split <code>ID</code> “TXCV-4” which would later be corrected.</p>
<p>Finally, I subset <code>slp_obs</code> and then with <code>slp_stations</code> make vector <code>slp</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
# Load observations and trim
slp_obs &lt;- slp_raw[slp_obs_n]

# Combine stations and obs
slp &lt;- str_c(slp_stations, slp_obs)</code></pre>
</div>
<p>Following is a look at the head of <code>slp</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
head(slp, n = 5L)</code></pre>
<pre><code>
[1] &quot;KBRO\tBROWNSVILLE INTL ARPT                        25.91 -97.42   1002.9 25/1153   300/022  25/1853   290/032 25/1753  &quot;
[2] &quot;KHRL\tHARLINGEN VALLEY INTL ARPT                   26.22 -97.66   1003.6 25/1252   310/023  25/1841   310/033 25/1852  &quot;
[3] &quot;KPIL\tPORT ISABEL ARPT                             26.15 -97.23   1001.9 25/1253   300/024  25/1553   300/034 25/1453  &quot;
[4] &quot;KBKS\tBROOKS COUNTY ARPT                           26.20 -98.12   1002.2 26/0215   290/019  26/0215   290/027 26/0215  &quot;
[5] &quot;KTXS33                                            26.13 -97.17   1003.0 25/2240   999/999  99/9999   999/999 99/9999  &quot; </code></pre>
</div>
<h4 id="id-id-station-station-opt">ID [<code>ID</code>], Station [<code>Station</code>] (opt)</h4>
<p>Matching <code>ID</code> and <code>Station</code> is easier after switching the first “-” with a “\t”. <code>Station</code> is optional. To find the end of the string I simply looked for the latitude pattern that would follow.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
            # ID-Station
            &quot;(\\w+)\t*(?&lt;=\t{0,1})(.+)(?=\\s+\\d{2}\\.\\d{2})&quot;,</code></pre>
</div>
<h4 id="latitude-lat">Latitude [<code>Lat</code>]</h4>
<p>Latitude was also very easy to extract. The pattern just looks for four digits with a decimal splitting in half.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
            # Lat
            &quot;\\s+(\\d{2}\\.\\d{2})&quot;,</code></pre>
</div>
<h4 id="longitude-lon">Longitude [<code>Lon</code>]</h4>
<p>Extracting Longitude was a little bit more of a challenge. Most observations have a negative longitude value (since occurring in the northwestern hemisphere). This was accurately reflected in the text products; mostly. Some values did not contain the leading “-” such as <code>Station</code> “KEFD”:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
slp[grep(&quot;^KEFD&quot;, slp)][2]</code></pre>
<pre><code>
[1] &quot;KEFD                                              29.62 95.17    1003.4 29/1650   160/027  26/1750   360/036 29/2150  &quot;</code></pre>
</div>
<p>To accomodate the possibilities, I had to be loose with the number of digits expected in addition to making the negative sign optional.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
            # Lon
            &quot;\\s+-*(\\d{2,6}\\.\\d{2})&quot;,</code></pre>
</div>
<h4 id="minimum-pressure-pres-opt">Minimum Pressure [<code>Pres</code>] <em>opt</em></h4>
<p>Expected pressure values would have a format like <code>\\d{3,4}\\.\\d{2}</code>. Some observations had values of “9999.0” which clearly were invalid (expected ranges were roughly between 940 and 1010). These would later be cleaned up.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
            # Pres
            &quot;\\s+(\\d{1,4}\\.\\d{1})*&quot;,</code></pre>
</div>
<h4 id="datetime-of-pressure-observation-presdt-opt">Date/time of pressure observation [<code>PresDT</code>] <em>opt</em></h4>
<p><code>PresDT</code> was initially split to extract the date value first (<code>PresDTd</code>) followed by the “%h%m” value (<code>PresDThm</code>). The general format, “\d{2}/\d{4}” would not work primarily because many observations contained the text “MM” or “N/A”.</p>
<p>Additionally, some observations also held the value “99/9999”. This would be accepted by the default format but would fail when converting the values to a valid date/time variable. These would later be cleaned.</p>
<p>With this, I ended up being very generous with the regex.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
            # PresDTd, PresDThm
            &quot;\\s+(\\w{1,3}|N)*/*(\\w{1,4})*&quot;,</code></pre>
</div>
<h4 id="pressure-remarks-presrmks-opt">Pressure remarks [<code>PresRmks</code>] <em>opt</em></h4>
<p>As noted previously, some <code>Pres</code> variables may be incomplete for unknown reasons. These values would be indicated with the letter “I” as noted in the “RCPT2” example earlier.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
            # PresRmks
            &quot;\\s+(I)*&quot;,</code></pre>
</div>
<h4 id="maximum-sustained-wind-direction-winddir-maximum-sustained-winds-opt-wind">Maximum sustained wind direction [<code>WindDir</code>], Maximum sustained winds (opt) [<code>Wind</code>]</h4>
<p>Variables <code>WindDir</code> and <code>Wind</code> were split with a “/” character. However, again, not all values were numeric as expected, such as “LOPL1”:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
slp[grep(&quot;^LOPL1&quot;, slp)]</code></pre>
<pre><code>
[1] &quot;LOPL1\tLA OFFSHORE OIL PORT                        28.88  -90.03   998.1 07/2216   080/029 07/2011    090/037 07/1811  &quot;</code></pre>
</div>
<p>Invalid values such as “999” would later be marked as <code>NA</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
            # WindDir, Wind
            &quot;\\s+(\\w{3})/(\\d{3})&quot;,</code></pre>
</div>
<p>The remaining variables followed generally the same rules as similar variables above (i.e., <code>GustDir</code> for <code>WindDir</code>, <code>GustDT</code> for <code>WindDT</code>, etc.). The final <code>str_match</code> call brought all expected observations in order.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
# Begin extraction. Move to dataframe and rename variables.
slp_df &lt;-
  str_match(
    slp,
    sprintf(&quot;^%s%s%s%s%s%s%s%s%s%s%s%s$&quot;,
            # ID-Station
            &quot;(\\w+)\t*(?&lt;=\t{0,1})(.+)(?=\\s+\\d{2}\\.\\d{2})&quot;,
            # Lat
            &quot;\\s+(\\d{2}\\.\\d{2})&quot;,
            # Lon
            &quot;\\s+-*(\\d{2,6}\\.\\d{2})&quot;,
            # Pres
            &quot;\\s+(\\d{1,4}\\.\\d{1})*&quot;,
            # PresDTd, PresDThm
            &quot;\\s+(\\w{1,3}|N)*/*(\\w{1,4})*&quot;,
            # PresRmks
            &quot;\\s+(I)*&quot;,
            # WindDir, Wind
            &quot;\\s+(\\w{3})/(\\d{3})&quot;,
            # Wind DTd, WindDThm
            &quot;\\s+(\\d{2,3})*/*(\\d{3,4})*&quot;,
            # WindRmks
            &quot;\\s+(I)*&quot;,
            # GustDir, Gust
            &quot;\\s+(\\w{3})*/*(\\d{3})*&quot;,
            # GustDTd, GustDThm
            &quot;\\s+(\\d{2,3})*/*(\\d{3,4})*&quot;,
            # GustRmks
            &quot;\\s+(I)*&quot;
    )
  ) %&gt;%
  as_tibble(.name_repair = &quot;minimal&quot;) %&gt;%
  set_names(nm = slp_df_names) %&gt;%
  arrange(ID) %&gt;%
  select(-txt)</code></pre>
</div>
<h3 id="rainfall">Rainfall</h3>
<p>Section C of the text products listed recorded rainfall observations across the Texas and Louisiana area. These observations were similar in format to those of pressure:</p>
<pre><code>
COLETO CREEK                 GOLIAD              CKDT2         9.42 I
28.73  -97.17</code></pre>
<p>The following fields were extracted:</p>
<ul>
<li><p><code>Location</code> (“COLETO CREEK”)</p></li>
<li><p><code>Count</code> (“GOLIAD”)</p></li>
<li><p><code>Station</code> (“CKDT2”) <em>opt</em></p></li>
<li><p><code>Rain</code> (“9.42”)</p></li>
<li><p><code>RainRmks</code> (“I”)</p></li>
<li><p><code>Lat</code> (“28.73”)</p></li>
<li><p><code>Lon</code> (“-97.17”)</p></li>
</ul>
<p>Extracting these observations followed the same premise for that of <code>slp</code>; identifying the latitude lines then subsetting those indices and the previous indices and combining into a vector.</p>
<p>Unlike <code>slp</code>, there were no surprises in cleaning this data. The regex used:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
rain_df &lt;- str_match(rain,
                     pattern = sprintf(&quot;^%s%s\\s+%s\\s+%s\\s*%s\\s+%s\\s+%s$&quot;,
                                       &quot;(.{29})&quot;,
                                       &quot;(.{19})&quot;,
                                       &quot;(.{0,12})&quot;,
                                       &quot;(\\d{1,2}\\.\\d{2})&quot;,
                                       &quot;(I)*&quot;,
                                       &quot;(\\d{1,2}\\.\\d{2})&quot;,
                                       &quot;-*(\\d{2,3}\\.\\d{2})&quot;)) %&gt;%
  as_tibble(.name_repair = &quot;minimal&quot;) %&gt;%
  set_names(nm = rain_df_names) %&gt;%
  mutate_at(.vars = c(&quot;Rain&quot;, &quot;Lat&quot;, &quot;Lon&quot;), .funs = as.numeric) %&gt;%
  mutate(Lon = if_else(Lon &gt; 0, Lon * -1, Lon)) %&gt;%
  select(-txt)</code></pre>
</div>
<h3 id="tornadoes">Tornadoes</h3>
<p>Section F lists reported tornadoes for each region of responsibility. Some NWS offices reported no tornado observations. Others, such as Houston, reported at least a dozen.</p>
<p>An example observation is as follows:</p>
<pre><code>
4 NNE SEADRIFT               CALHOUN          25/2114          EF0   
28.43  -96.67

FACEBOOK PHOTOS AND VIDEO SHOWED A BRIEF TORNADO TOUCHED DOWN ON
GATES ROAD NEAR SEADRIFT. A SHED AND CARPORT WERE DESTROYED AND A
FEW TREES WERE BLOWN DOWN. RATED EF0. </code></pre>
<p>Each observation, again, was preceeded and proceeded by an empty line.</p>
<ul>
<li><p><code>Location</code> (“4 NNE SEADRIFT”)</p></li>
<li><p><code>County</code> (“CALHOUN”)</p></li>
<li><p><code>Date</code> (“25/2114”)</p></li>
<li><p><code>Scale</code> (“EFO”)</p></li>
<li><p><code>Lat</code> (“28.43”)</p></li>
<li><p><code>Lon</code> (“-96.67”)</p></li>
<li><p><code>Details</code> (“FACEBOOK PHOTOS…”)</p></li>
</ul>
<p>Extracting the first two lines used the same technique as previous. However, extracting the <code>Details</code> required a little creativity since many spread over several lines.</p>
<p>To do this, I took the values of <code>tor_y_n</code> which marked the indices of the latitude/longitude positions. Then, I created vector <code>tor_z_n</code> to identify all “^\s+” elements in the original vector, <code>tor_raw</code>. With this, I was able to identify the first “^\s+” index following the latitude/longitude line, <code>t_a</code> and then take the very next index, <code>t_b</code>.</p>
<p>Apologies for the non-descriptive names; I was lacking ingenuity.</p>
<p>With <code>t_a</code> and <code>t_b</code>, I used <code>map2</code> through <code>tor_raw</code> to extract each subset. From that point there was some cleaning to bring the lines together as needed. If you have any better (even if slower, but more creative), I would love to hear them! I may have tried to get too creative with this task.</p>
<p>The regex was very similar to the <code>rain</code> regex as most items were evenly delimited.</p>
<h2 id="previous-revisions">Previous Revisions</h2>
<div class="layout-chunk" data-layout="l-body">

<pre class="r"><code>
input %&gt;% 
  self_get_versions() %&gt;% 
  dplyr::mutate(
    Version = kableExtra::text_spec(short_sha, link = url)
  ) %&gt;%
  dplyr::select(Version, Message, Date, Author) %&gt;%
  knitr::kable(
    row.names = FALSE, 
    escape = FALSE
  ) %&gt;% 
  kableExtra::kable_styling()</code></pre>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Version
</th>
<th style="text-align:left;">
Message
</th>
<th style="text-align:left;">
Date
</th>
<th style="text-align:left;">
Author
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<a href="https://github.com/timtrice/hurricane_harvey_prelims/blob/38a6edc24c819b68d015d5c402bd004bf52f0f36/data.Rmd" style="     ">38a6edc</a>
</td>
<td style="text-align:left;">
Rebuild website, Sun Jun 30 17:36:16 UTC 2019 [skip ci]
</td>
<td style="text-align:left;">
2019-06-30
</td>
<td style="text-align:left;">
Travis CI
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://github.com/timtrice/hurricane_harvey_prelims/blob/c2197ed3d0787836c5152daa75c8bf324f541768/data.Rmd" style="     ">c2197ed</a>
</td>
<td style="text-align:left;">
Correct path to script
</td>
<td style="text-align:left;">
2019-06-30
</td>
<td style="text-align:left;">
Tim Trice
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://github.com/timtrice/hurricane_harvey_prelims/blob/01fc4ae479a8ffc639ea328cb06863455da36216/data.Rmd" style="     ">01fc4ae</a>
</td>
<td style="text-align:left;">
Add children
</td>
<td style="text-align:left;">
2019-06-30
</td>
<td style="text-align:left;">
Tim Trice
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://github.com/timtrice/hurricane_harvey_prelims/blob/03a2e1e29e9c87aed75a804e942268b1a21e81e1/data.Rmd" style="     ">03a2e1e</a>
</td>
<td style="text-align:left;">
Update Rmd yaml front matter
</td>
<td style="text-align:left;">
2019-06-30
</td>
<td style="text-align:left;">
Tim Trice
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://github.com/timtrice/hurricane_harvey_prelims/blob/fbf3f491f7e0a8038c7b6636f44cf97ac79080f5/data.Rmd" style="     ">fbf3f49</a>
</td>
<td style="text-align:left;">
Correct chunk links
</td>
<td style="text-align:left;">
2019-06-30
</td>
<td style="text-align:left;">
Tim Trice
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://github.com/timtrice/hurricane_harvey_prelims/blob/0613f7895bab3daeb1ee394e7f3835ae8fee5add/data.Rmd" style="     ">0613f78</a>
</td>
<td style="text-align:left;">
Relocate analysis files
</td>
<td style="text-align:left;">
2019-06-30
</td>
<td style="text-align:left;">
Tim Trice
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://github.com/timtrice/hurricane_harvey_prelims/blob/be170f11e0e57a4d0fb4bb8cb4e6289cfdd493a3/data.Rmd" style="     ">be170f1</a>
</td>
<td style="text-align:left;">
Add published docs
</td>
<td style="text-align:left;">
2019-03-01
</td>
<td style="text-align:left;">
Tim Trice
</td>
</tr>
</tbody>
</table>
</div>
<h2 id="session-info">Session Info</h2>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
si &lt;- sessioninfo::session_info()</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
si$platform</code></pre>
<pre><code>
 setting  value                       
 version  R version 3.6.0 (2017-01-27)
 os       Ubuntu 14.04.5 LTS          
 system   x86_64, linux-gnu           
 ui       X11                         
 language (EN)                        
 collate  en_US.UTF-8                 
 ctype    en_US.UTF-8                 
 tz       UTC                         
 date     2019-06-30                  </code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Package
</th>
<th style="text-align:left;">
Version
</th>
<th style="text-align:left;">
Date
</th>
<th style="text-align:left;">
Source
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
dplyr
</td>
<td style="text-align:left;">
0.8.2
</td>
<td style="text-align:left;">
2019-06-29
</td>
<td style="text-align:left;">
CRAN (R 3.6.0)
</td>
</tr>
<tr>
<td style="text-align:left;">
glue
</td>
<td style="text-align:left;">
1.3.1
</td>
<td style="text-align:left;">
2019-03-12
</td>
<td style="text-align:left;">
CRAN (R 3.6.0)
</td>
</tr>
<tr>
<td style="text-align:left;">
lubridate
</td>
<td style="text-align:left;">
1.7.4
</td>
<td style="text-align:left;">
2018-04-11
</td>
<td style="text-align:left;">
CRAN (R 3.6.0)
</td>
</tr>
<tr>
<td style="text-align:left;">
purrr
</td>
<td style="text-align:left;">
0.3.2
</td>
<td style="text-align:left;">
2019-03-15
</td>
<td style="text-align:left;">
CRAN (R 3.6.0)
</td>
</tr>
<tr>
<td style="text-align:left;">
stringr
</td>
<td style="text-align:left;">
1.4.0
</td>
<td style="text-align:left;">
2019-02-10
</td>
<td style="text-align:left;">
CRAN (R 3.6.0)
</td>
</tr>
<tr>
<td style="text-align:left;">
tibble
</td>
<td style="text-align:left;">
2.1.3
</td>
<td style="text-align:left;">
2019-06-06
</td>
<td style="text-align:left;">
CRAN (R 3.6.0)
</td>
</tr>
</tbody>
</table>
</div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
